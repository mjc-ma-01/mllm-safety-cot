  0%|          | 0/2256 [00:00<?, ?it/s]`use_cache=True` is incompatible with gradient checkpointing. Setting `use_cache=False`.
  6%|â–Œ         | 130/2256 [03:29<54:13,  1.53s/it]Exception in thread Thread-2:
{'loss': 1.5905, 'grad_norm': 17.734132766723633, 'learning_rate': 1.9920212765957446e-05, 'mean_token_accuracy': 0.6174945652484893, 'epoch': 0.01}
{'loss': 1.4698, 'grad_norm': 22.31102180480957, 'learning_rate': 1.9831560283687945e-05, 'mean_token_accuracy': 0.6222353219985962, 'epoch': 0.03}
{'loss': 1.4881, 'grad_norm': 21.037391662597656, 'learning_rate': 1.974290780141844e-05, 'mean_token_accuracy': 0.615561181306839, 'epoch': 0.04}
{'loss': 1.3164, 'grad_norm': 13.505035400390625, 'learning_rate': 1.965425531914894e-05, 'mean_token_accuracy': 0.6362682223320008, 'epoch': 0.05}
{'loss': 1.2971, 'grad_norm': 11.739895820617676, 'learning_rate': 1.9565602836879435e-05, 'mean_token_accuracy': 0.6499499320983887, 'epoch': 0.07}
{'loss': 1.3551, 'grad_norm': 12.809534072875977, 'learning_rate': 1.947695035460993e-05, 'mean_token_accuracy': 0.6417233765125274, 'epoch': 0.08}
{'loss': 1.3329, 'grad_norm': 23.89954376220703, 'learning_rate': 1.9388297872340425e-05, 'mean_token_accuracy': 0.6386290550231933, 'epoch': 0.09}
{'loss': 1.392, 'grad_norm': 15.52906322479248, 'learning_rate': 1.9299645390070924e-05, 'mean_token_accuracy': 0.6233852863311767, 'epoch': 0.11}
{'loss': 1.265, 'grad_norm': 16.12841033935547, 'learning_rate': 1.921099290780142e-05, 'mean_token_accuracy': 0.6435019791126251, 'epoch': 0.12}
{'loss': 1.2919, 'grad_norm': 13.814986228942871, 'learning_rate': 1.9122340425531915e-05, 'mean_token_accuracy': 0.6385592877864837, 'epoch': 0.13}
{'loss': 1.3107, 'grad_norm': 9.265182495117188, 'learning_rate': 1.9033687943262414e-05, 'mean_token_accuracy': 0.6439216256141662, 'epoch': 0.15}
{'loss': 1.1904, 'grad_norm': 11.75111198425293, 'learning_rate': 1.894503546099291e-05, 'mean_token_accuracy': 0.6555657029151917, 'epoch': 0.16}
Traceback (most recent call last):
  File "/mnt/petrelfs/majiachen/project/mllm-safety-cot/src/sft_vlm_cot_.py", line 247, in <module>
    trainer.train()
  File "/mnt/petrelfs/majiachen/miniconda3/envs/v-oocr/lib/python3.10/site-packages/transformers/trainer.py", line 2245, in train
    return inner_training_loop(
  File "/mnt/petrelfs/majiachen/miniconda3/envs/v-oocr/lib/python3.10/site-packages/transformers/trainer.py", line 2627, in _inner_training_loop
    self._maybe_log_save_evaluate(
  File "/mnt/petrelfs/majiachen/miniconda3/envs/v-oocr/lib/python3.10/site-packages/transformers/trainer.py", line 3092, in _maybe_log_save_evaluate
    self.log(logs, start_time)
  File "/mnt/petrelfs/majiachen/miniconda3/envs/v-oocr/lib/python3.10/site-packages/trl/trainer/sft_trainer.py", line 513, in log
    super().log(logs, start_time)
  File "/mnt/petrelfs/majiachen/miniconda3/envs/v-oocr/lib/python3.10/site-packages/transformers/trainer.py", line 3652, in log
    self.control = self.callback_handler.on_log(self.args, self.state, self.control, logs)
  File "/mnt/petrelfs/majiachen/miniconda3/envs/v-oocr/lib/python3.10/site-packages/transformers/trainer_callback.py", line 549, in on_log
    return self.call_event("on_log", args, state, control, logs=logs)
  File "/mnt/petrelfs/majiachen/miniconda3/envs/v-oocr/lib/python3.10/site-packages/transformers/trainer_callback.py", line 556, in call_event
    result = getattr(callback, event)(
  File "/mnt/petrelfs/majiachen/miniconda3/envs/v-oocr/lib/python3.10/site-packages/transformers/integrations/integration_utils.py", line 726, in on_log
    self.tb_writer.flush()
  File "/mnt/petrelfs/majiachen/miniconda3/envs/v-oocr/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 1194, in flush
    writer.flush()
  File "/mnt/petrelfs/majiachen/miniconda3/envs/v-oocr/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 153, in flush
Traceback (most recent call last):
  File "/mnt/petrelfs/majiachen/project/mllm-safety-cot/src/sft_vlm_cot_.py", line 247, in <module>
    trainer.train()
  File "/mnt/petrelfs/majiachen/miniconda3/envs/v-oocr/lib/python3.10/site-packages/transformers/trainer.py", line 2245, in train
    return inner_training_loop(
      File "/mnt/petrelfs/majiachen/miniconda3/envs/v-oocr/lib/python3.10/site-packages/transformers/trainer.py", line 2627, in _inner_training_loop
    self._maybe_log_save_evaluate(
self.event_writer.flush()
  File "/mnt/petrelfs/majiachen/miniconda3/envs/v-oocr/lib/python3.10/site-packages/transformers/trainer.py", line 3092, in _maybe_log_save_evaluate
    self.log(logs, start_time)
  File "/mnt/petrelfs/majiachen/miniconda3/envs/v-oocr/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 125, in flush
  File "/mnt/petrelfs/majiachen/miniconda3/envs/v-oocr/lib/python3.10/site-packages/trl/trainer/sft_trainer.py", line 513, in log
    super().log(logs, start_time)
  File "/mnt/petrelfs/majiachen/miniconda3/envs/v-oocr/lib/python3.10/site-packages/transformers/trainer.py", line 3652, in log
    self.control = self.callback_handler.on_log(self.args, self.state, self.control, logs)
  File "/mnt/petrelfs/majiachen/miniconda3/envs/v-oocr/lib/python3.10/site-packages/transformers/trainer_callback.py", line 549, in on_log
    return self.call_event("on_log", args, state, control, logs=logs)
  File "/mnt/petrelfs/majiachen/miniconda3/envs/v-oocr/lib/python3.10/site-packages/transformers/trainer_callback.py", line 556, in call_event
    result = getattr(callback, event)(
  File "/mnt/petrelfs/majiachen/miniconda3/envs/v-oocr/lib/python3.10/site-packages/transformers/integrations/integration_utils.py", line 726, in on_log
    self.tb_writer.flush()
  File "/mnt/petrelfs/majiachen/miniconda3/envs/v-oocr/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 1194, in flush
    writer.flush()
  File "/mnt/petrelfs/majiachen/miniconda3/envs/v-oocr/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 153, in flush
    self.event_writer.flush()
  File "/mnt/petrelfs/majiachen/miniconda3/envs/v-oocr/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 125, in flush
    self._async_writer.flush()
  File "/mnt/petrelfs/majiachen/miniconda3/envs/v-oocr/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 194, in flush
    self._check_worker_status()
  File "/mnt/petrelfs/majiachen/miniconda3/envs/v-oocr/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
      File "/mnt/petrelfs/majiachen/miniconda3/envs/v-oocr/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
self._async_writer.flush()
  File "/mnt/petrelfs/majiachen/miniconda3/envs/v-oocr/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
    self._run()
  File "/mnt/petrelfs/majiachen/miniconda3/envs/v-oocr/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 194, in flush
  File "/mnt/petrelfs/majiachen/miniconda3/envs/v-oocr/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
    self._record_writer.write(data)
  File "/mnt/petrelfs/majiachen/miniconda3/envs/v-oocr/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
    self._writer.write(header + header_crc + data + footer_crc)
  File "/mnt/petrelfs/majiachen/miniconda3/envs/v-oocr/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
    self.fs.append(self.filename, file_content, self.binary_mode)
  File "/mnt/petrelfs/majiachen/miniconda3/envs/v-oocr/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
    self._write(filename, file_content, "ab" if binary_mode else "a")
  File "/mnt/petrelfs/majiachen/miniconda3/envs/v-oocr/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
    with io.open(filename, mode, encoding=encoding) as f:
FileNotFoundError: [Errno 2] No such file or directory: b'/mnt/lustrenew/mllm_safety-shared/tmp/majiachen/results/model:sft_mllm_llava1.5_7b/train:mmsafetybench+sharedgpt4v_v1/runs/Apr12_20-30-19_SH-IDCA1404-10-140-54-3/events.out.tfevents.1744461073.SH-IDCA1404-10-140-54-3.35455.0'
    self._check_worker_status()
  File "/mnt/petrelfs/majiachen/miniconda3/envs/v-oocr/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
    raise exception
  File "/mnt/petrelfs/majiachen/miniconda3/envs/v-oocr/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
[rank0]: Traceback (most recent call last):
[rank0]:   File "/mnt/petrelfs/majiachen/project/mllm-safety-cot/src/sft_vlm_cot_.py", line 247, in <module>
[rank0]:     trainer.train()
[rank0]:   File "/mnt/petrelfs/majiachen/miniconda3/envs/v-oocr/lib/python3.10/site-packages/transformers/trainer.py", line 2245, in train
[rank0]:     return inner_training_loop(
[rank0]:   File "/mnt/petrelfs/majiachen/miniconda3/envs/v-oocr/lib/python3.10/site-packages/transformers/trainer.py", line 2627, in _inner_training_loop
[rank0]:     self._maybe_log_save_evaluate(
[rank0]:   File "/mnt/petrelfs/majiachen/miniconda3/envs/v-oocr/lib/python3.10/site-packages/transformers/trainer.py", line 3092, in _maybe_log_save_evaluate
[rank0]:     self.log(logs, start_time)
[rank0]:   File "/mnt/petrelfs/majiachen/miniconda3/envs/v-oocr/lib/python3.10/site-packages/trl/trainer/sft_trainer.py", line 513, in log
[rank0]:     super().log(logs, start_time)
[rank0]:   File "/mnt/petrelfs/majiachen/miniconda3/envs/v-oocr/lib/python3.10/site-packages/transformers/trainer.py", line 3652, in log
[rank0]:     self.control = self.callback_handler.on_log(self.args, self.state, self.control, logs)
[rank0]:   File "/mnt/petrelfs/majiachen/miniconda3/envs/v-oocr/lib/python3.10/site-packages/transformers/trainer_callback.py", line 549, in on_log
[rank0]:     return self.call_event("on_log", args, state, control, logs=logs)
[rank0]:   File "/mnt/petrelfs/majiachen/miniconda3/envs/v-oocr/lib/python3.10/site-packages/transformers/trainer_callback.py", line 556, in call_event
[rank0]:     result = getattr(callback, event)(
[rank0]:   File "/mnt/petrelfs/majiachen/miniconda3/envs/v-oocr/lib/python3.10/site-packages/transformers/integrations/integration_utils.py", line 726, in on_log
[rank0]:     self.tb_writer.flush()
[rank0]:   File "/mnt/petrelfs/majiachen/miniconda3/envs/v-oocr/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 1194, in flush
[rank0]:     writer.flush()
[rank0]:   File "/mnt/petrelfs/majiachen/miniconda3/envs/v-oocr/lib/python3.10/site-packages/torch/utils/tensorboard/writer.py", line 153, in flush
[rank0]:     self.event_writer.flush()
[rank0]:   File "/mnt/petrelfs/majiachen/miniconda3/envs/v-oocr/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 125, in flush
[rank0]:     self._async_writer.flush()
[rank0]:   File "/mnt/petrelfs/majiachen/miniconda3/envs/v-oocr/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 194, in flush
[rank0]:     self._check_worker_status()
[rank0]:   File "/mnt/petrelfs/majiachen/miniconda3/envs/v-oocr/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 212, in _check_worker_status
[rank0]:     raise exception
[rank0]:   File "/mnt/petrelfs/majiachen/miniconda3/envs/v-oocr/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
[rank0]:     self.run()
[rank0]:   File "/mnt/petrelfs/majiachen/miniconda3/envs/v-oocr/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 244, in run
[rank0]:     self._run()
[rank0]:   File "/mnt/petrelfs/majiachen/miniconda3/envs/v-oocr/lib/python3.10/site-packages/tensorboard/summary/writer/event_file_writer.py", line 275, in _run
[rank0]:     self._record_writer.write(data)
[rank0]:   File "/mnt/petrelfs/majiachen/miniconda3/envs/v-oocr/lib/python3.10/site-packages/tensorboard/summary/writer/record_writer.py", line 40, in write
[rank0]:     self._writer.write(header + header_crc + data + footer_crc)
[rank0]:   File "/mnt/petrelfs/majiachen/miniconda3/envs/v-oocr/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 775, in write
[rank0]:     self.fs.append(self.filename, file_content, self.binary_mode)
[rank0]:   File "/mnt/petrelfs/majiachen/miniconda3/envs/v-oocr/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 167, in append
[rank0]:     self._write(filename, file_content, "ab" if binary_mode else "a")
[rank0]:   File "/mnt/petrelfs/majiachen/miniconda3/envs/v-oocr/lib/python3.10/site-packages/tensorboard/compat/tensorflow_stub/io/gfile.py", line 171, in _write
[rank0]:     with io.open(filename, mode, encoding=encoding) as f:
[rank0]: FileNotFoundError: [Errno 2] No such file or directory: b'/mnt/lustrenew/mllm_safety-shared/tmp/majiachen/results/model:sft_mllm_llava1.5_7b/train:mmsafetybench+sharedgpt4v_v1/runs/Apr12_20-30-19_SH-IDCA1404-10-140-54-3/events.out.tfevents.1744461073.SH-IDCA1404-10-140-54-3.35455.0'
