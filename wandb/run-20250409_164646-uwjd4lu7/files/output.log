  0%|          | 0/561 [00:00<?, ?it/s]Traceback (most recent call last):
> /mnt/petrelfs/majiachen/project/mllm-safety-cot/src/sft_vlm_cot.py(167)multimodal_collator()
-> prompt_response_batch = processor(text=prompt_response_texts, images=images, return_tensors="pt", padding=True)
(Pdb) ["[INST] <image>\nYou are a helpful and harmless assistant.You are given an image and a question, You should think step-by-step and answer the question.\nQuestion: What are the key elements in this picture?\n\n [/INST] This is a black and white photo capturing a moment at a train station. The main subject of the image is a white train with black lettering, which is moving away from the camera. The train is located on the left side of the tracks. The tracks themselves are made of metal and are laid on a bed of gravel.\n\nOn the left side of the photo, you can see a train station made of brick. It's surrounded by a fence, adding an element of security to the scene. In the background, there's a large building with numerous windows, also constructed from brick. This building is situated on the left side of the photo, providing a sense of depth and perspective to the image.\n\nAbove all these elements, the sky stretches out, filled with clouds that add a dramatic touch to the overall composition. Despite being a black and white photo, it's rich in details and tells a story about everyday life at this particular train station.</s> ", "[INST] <image>\nYou are a helpful and harmless assistant.You are given an image and a question, You should think step-by-step and answer the question.\nQuestion: Can you describe the main features of this image for me?\n<image>\n\n [/INST] In the heart of the image, a zebra stands majestically, its black and white stripes contrasting sharply with the earthy tones of its surroundings. The zebra is positioned in profile, facing towards the right side of the image, allowing us to appreciate its distinctive mane and tail, both as dark as night. \n\nThe zebra's enclosure is a simple one, surrounded by a wire fence that blends subtly into the background. The ground beneath the zebra's hooves is a patchwork of dirt and sparse grass, hinting at a dry climate.\n\nThe backdrop to this scene is a lush tapestry of trees and bushes, their green leaves providing a refreshing splash of color. One tree trunk in particular stands out, located behind the zebra and slightly to its left. This tree, stripped of its leaves, adds an element of stark beauty to the scene.\n\nOverall, this image captures a moment of tranquility in the life of a zebra, surrounded by nature in its enclosure.</s> ", '[INST] <image>\nYou are a helpful and harmless assistant.You are given an image and a question, You should think step-by-step and answer the question.\nQuestion: Explain the visual content of the image in great detail.\n<image>\n\n [/INST] The image captures a serene rural landscape under a clear blue sky. On the left side of the image, there\'s a **red stop sign** standing prominently. Its octagonal shape and bold color make it easily noticeable. \n\nOn the right side of the image, there\'s a **white rectangular billboard sign** that reads "COMANCHE" in black letters. The stark contrast between the white background and black letters makes the text stand out.\n\nThe road in the foreground runs from the left to the right side of the image, leading the viewer\'s eyes towards the distant mountains. The road seems to be inviting one to embark on a journey towards these majestic mountains.\n\nThe mountains in the background rise against the blue sky, their peaks lightly dusted with clouds. They add a sense of depth and vastness to the scene.\n\nIn the foreground, there\'s a grassy field enclosed by a fence, adding to the rural charm of the scene. The green of the field contrasts beautifully with the blue of the sky, creating a calming and peaceful atmosphere.\n\nOverall, this image paints a picture of a tranquil countryside scene, where man-made elements like the stop sign and billboard coexist harmoniously with nature.</s> ', '[INST] <image>\nYou are a helpful and harmless assistant.You are given an image and a question, You should think step-by-step and answer the question.\nQuestion: What do you see happening in this image?\n<image>\n\n [/INST] In the image, a dynamic scene unfolds on a sandy beach under a cloudy sky. A brow
(Pdb) "[INST] <image>\nYou are a helpful and harmless assistant.You are given an image and a question, You should think step-by-step and answer the question.\nQuestion: What are the key elements in this picture?\n\n [/INST] This is a black and white photo capturing a moment at a train station. The main subject of the image is a white train with black lettering, which is moving away from the camera. The train is located on the left side of the tracks. The tracks themselves are made of metal and are laid on a bed of gravel.\n\nOn the left side of the photo, you can see a train station made of brick. It's surrounded by a fence, adding an element of security to the scene. In the background, there's a large building with numerous windows, also constructed from brick. This building is situated on the left side of the photo, providing a sense of depth and perspective to the image.\n\nAbove all these elements, the sky stretches out, filled with clouds that add a dramatic touch to the overall composition. Despite being a black and white photo, it's rich in details and tells a story about everyday life at this particular train station.</s> "
(Pdb) <PIL.Image.Image image mode=RGB size=427x640 at 0x7FAEB4196110>
(Pdb) 4
(Pdb) 4
(Pdb) (Pdb) (Pdb) (Pdb) *** StopIteration
(Pdb) *** NameError: name 'prompt_response_batch' is not defined
(Pdb) (Pdb) ["[INST] <image>\nYou are a helpful and harmless assistant.You are given an image and a question, You should think step-by-step and answer the question.\nQuestion: What are the key elements in this picture?\n\n [/INST] This is a black and white photo capturing a moment at a train station. The main subject of the image is a white train with black lettering, which is moving away from the camera. The train is located on the left side of the tracks. The tracks themselves are made of metal and are laid on a bed of gravel.\n\nOn the left side of the photo, you can see a train station made of brick. It's surrounded by a fence, adding an element of security to the scene. In the background, there's a large building with numerous windows, also constructed from brick. This building is situated on the left side of the photo, providing a sense of depth and perspective to the image.\n\nAbove all these elements, the sky stretches out, filled with clouds that add a dramatic touch to the overall composition. Despite being a black and white photo, it's rich in details and tells a story about everyday life at this particular train station.</s> ", "[INST] <image>\nYou are a helpful and harmless assistant.You are given an image and a question, You should think step-by-step and answer the question.\nQuestion: Can you describe the main features of this image for me?\n<image>\n\n [/INST] In the heart of the image, a zebra stands majestically, its black and white stripes contrasting sharply with the earthy tones of its surroundings. The zebra is positioned in profile, facing towards the right side of the image, allowing us to appreciate its distinctive mane and tail, both as dark as night. \n\nThe zebra's enclosure is a simple one, surrounded by a wire fence that blends subtly into the background. The ground beneath the zebra's hooves is a patchwork of dirt and sparse grass, hinting at a dry climate.\n\nThe backdrop to this scene is a lush tapestry of trees and bushes, their green leaves providing a refreshing splash of color. One tree trunk in particular stands out, located behind the zebra and slightly to its left. This tree, stripped of its leaves, adds an element of stark beauty to the scene.\n\nOverall, this image captures a moment of tranquility in the life of a zebra, surrounded by nature in its enclosure.</s> ", '[INST] <image>\nYou are a helpful and harmless assistant.You are given an image and a question, You should think step-by-step and answer the question.\nQuestion: Explain the visual content of the image in great detail.\n<image>\n\n [/INST] The image captures a serene rural landscape under a clear blue sky. On the left side of the image, there\'s a **red stop sign** standing prominently. Its octagonal shape and bold color make it easily noticeable. \n\nOn the right side of the image, there\'s a **white rectangular billboard sign** that reads "COMANCHE" in black letters. The stark contrast between the white background and black letters makes the text stand out.\n\nThe road in the foreground runs from the left to the right side of the image, leading the viewer\'s eyes towards the distant mountains. The road seems to be inviting one to embark on a journey towards these majestic mountains.\n\nThe mountains in the background rise against the blue sky, their peaks lightly dusted with clouds. They add a sense of depth and vastness to the scene.\n\nIn the foreground, there\'s a grassy field enclosed by a fence, adding to the rural charm of the scene. The green of the field contrasts beautifully with the blue of the sky, creating a calming and peaceful atmosphere.\n\nOverall, this image paints a picture of a tranquil countryside scene, where man-made elements like the stop sign and billboard coexist harmoniously with nature.</s> ', '[INST] <image>\nYou are a helpful and harmless assistant.You are given an image and a question, You should think step-by-step and answer the question.\nQuestion: What do you see happening in this image?\n<image>\n\n [/INST] In the image, a dynamic scene unfolds on a sandy beach under a cloudy sky.
(Pdb) *** StopIteration
(Pdb) *** NameError: name 'iamges' is not defined
(Pdb) [[<PIL.Image.Image image mode=RGB size=427x640 at 0x7FAEB07D1600>], [<PIL.Image.Image image mode=RGB size=500x375 at 0x7FAEB07D1420>], [<PIL.Image.Image image mode=RGB size=500x334 at 0x7FAEB07D0DF0>], [<PIL.Image.Image image mode=RGB size=2289x1500 at 0x7FAEB07D1090>]]
(Pdb)
  File "/mnt/petrelfs/majiachen/project/mllm-safety-cot/src/sft_vlm_cot.py", line 236, in <module>
    trainer.train()
  File "/mnt/petrelfs/majiachen/miniconda3/envs/v-oocr/lib/python3.10/site-packages/transformers/trainer.py", line 2241, in train
    return inner_training_loop(
  File "/mnt/petrelfs/majiachen/miniconda3/envs/v-oocr/lib/python3.10/site-packages/transformers/trainer.py", line 2500, in _inner_training_loop
    batch_samples, num_items_in_batch = self.get_batch_samples(epoch_iterator, num_batches)
  File "/mnt/petrelfs/majiachen/miniconda3/envs/v-oocr/lib/python3.10/site-packages/transformers/trainer.py", line 5180, in get_batch_samples
    batch_samples += [next(epoch_iterator)]
  File "/mnt/petrelfs/majiachen/miniconda3/envs/v-oocr/lib/python3.10/site-packages/accelerate/data_loader.py", line 573, in __iter__
    current_batch = send_to_device(current_batch, self.device, non_blocking=self._non_blocking)
UnboundLocalError: local variable 'current_batch' referenced before assignment
[rank0]: Traceback (most recent call last):
[rank0]:   File "/mnt/petrelfs/majiachen/project/mllm-safety-cot/src/sft_vlm_cot.py", line 236, in <module>
[rank0]:     trainer.train()
[rank0]:   File "/mnt/petrelfs/majiachen/miniconda3/envs/v-oocr/lib/python3.10/site-packages/transformers/trainer.py", line 2241, in train
[rank0]:     return inner_training_loop(
[rank0]:   File "/mnt/petrelfs/majiachen/miniconda3/envs/v-oocr/lib/python3.10/site-packages/transformers/trainer.py", line 2500, in _inner_training_loop
[rank0]:     batch_samples, num_items_in_batch = self.get_batch_samples(epoch_iterator, num_batches)
[rank0]:   File "/mnt/petrelfs/majiachen/miniconda3/envs/v-oocr/lib/python3.10/site-packages/transformers/trainer.py", line 5180, in get_batch_samples
[rank0]:     batch_samples += [next(epoch_iterator)]
[rank0]:   File "/mnt/petrelfs/majiachen/miniconda3/envs/v-oocr/lib/python3.10/site-packages/accelerate/data_loader.py", line 573, in __iter__
[rank0]:     current_batch = send_to_device(current_batch, self.device, non_blocking=self._non_blocking)
[rank0]: UnboundLocalError: local variable 'current_batch' referenced before assignment
